<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FCnet_overview_of_package • FCnet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="FCnet_overview_of_package">
<meta property="og:description" content="FCnet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FCnet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/FCnet_overview_of_package.html">FCnet_overview_of_package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="FCnet_overview_of_package_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>FCnet_overview_of_package</h1>
                        <h4 class="author">Elvio Blini</h4>
            
            <h4 class="date">December 2020</h4>
      
      
      <div class="hidden name"><code>FCnet_overview_of_package.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The analysis of (Functional Connectivity) neuroimaging data can be daunting due to the very high dimensionality of the features involved. In time, several approaches to the problem have been devised. <code>FCnet</code> allows one to easily implement a three steps procedure consisting of:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Feature reduction</strong>: the functional connectivity matrices are first summarized through data reduction techniques such as Principal Component Analysis or Independent Components Analysis.</p></li>
<li><p><strong>Robust regression</strong>: the reduced matrix of Weights is then entered into a robust regression model (with either ridge or LASSO penalty). The model is crossvalidated internally by means of Leave-One-Out (nested) crossvalidation.</p></li>
<li><p><strong>Back-projection</strong>: models’ coefficients can be back-projected onto the original space, in order to rank the most predictive edges of a matrix.</p></li>
</ol>
<p>For useful references, see: <a href="https://www.pnas.org/content/113/30/E4367">Siegel et al., 2016</a>; <a href="https://academic.oup.com/brain/article/143/7/2173/5861020">Salvalaggio et al., 2020</a>; <a href="https://link.springer.com/chapter/10.1007%2F978-3-030-59277-6_3">Calesella et al., 2020</a>.</p>
<p>This vignette will provide an overview of <code>FCnet</code> main routines.</p>
</div>
<div id="setting-up-the-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-the-simulation" class="anchor"></a>Setting up the simulation</h2>
<p>We will need the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"FCnet"</span><span class="op">)</span> <span class="co">#for the main analysis routines</span></code></pre></div>
<pre><code>## Loading required package: glmnet</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loaded glmnet 4.1-1</code></pre>
<pre><code>## Loading required package: glmnetUtils</code></pre>
<pre><code>## 
## Attaching package: 'glmnetUtils'</code></pre>
<pre><code>## The following objects are masked from 'package:glmnet':
## 
##     cv.glmnet, glmnet</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span> <span class="co">#beautiful depictions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span> <span class="co">#arrange plots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/HenrikBengtsson/future.apply">"future.apply"</a></span><span class="op">)</span> <span class="co">#for speed and parallel computing</span></code></pre></div>
<pre><code>## Loading required package: future</code></pre>
<p>In order to use your own set of matrices, you should make sure that these are imported in R as a list of lists. You can use several approaches in order to do that. The easiest way is probably to use <code><a href="../reference/loadFC.html">loadFC()</a></code>, which comes with the package <code>FCnet</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_matrices</span><span class="op">=</span> <span class="fu">FCnet</span><span class="fu">::</span><span class="fu"><a href="../reference/loadFC.html">loadFC</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Matrices should be stored as .csv files in a folder, and with specific formatting requirements.</p>
<p>The <code>FCnet</code> package comes with a 324x324 matrix of functional connectivity data obtained from 37 participants. We use it, in this overview, as a starting point to simulate several FC matrices which will help to illustrate the main functions of <code>FCnet</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"MeanFC"</span><span class="op">)</span> <span class="co">#the object MeanFC is now available</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">N_subs</span><span class="op">=</span> <span class="fl">50</span> <span class="co">#number of participants/matrices</span>
<span class="va">subjs_variability</span><span class="op">=</span> <span class="fl">0.2</span> <span class="co">#variability (sd) between matrices</span>

<span class="co">#this function creates several matrices by adding gaussian noise</span>
<span class="co">#with sd "variability" to a reference matrix</span>
<span class="va">m_start</span><span class="op">=</span> <span class="fu"><a href="../reference/simulateFCnet.html">simulateMat</a></span><span class="op">(</span>mat <span class="op">=</span> <span class="va">MeanFC</span>, 
                     Nmat <span class="op">=</span> <span class="va">N_subs</span>, 
                     mat_variability <span class="op">=</span> <span class="va">subjs_variability</span><span class="op">)</span></code></pre></div>
<p><code>m_start</code> is now a list of lists, the preferred format of <code>FCnet</code>, including several FC matrices putatively obtained from different individuals.</p>
<p>Now we perturb only one subset of these matrices (i.e. a network), in a very crude way, just to illustrate <code>FCnet</code>.</p>
<p>Specifically, we bias one network systematically, as a function of one behavioral score <code>y</code> (to be recovered in a subsequent step). In this scenario, a subset of edges will be injected with signal that is directly related to the behavioral score to be ultimately predicted: these edges will be correlated with the score <code>y</code>. To have a more realistic simulation, this bias will not be constant but rather modulated by a random factor such that different participants may present different degrees of this bias.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N_subs</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd<span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#the behavioral score</span>

<span class="va">network1</span><span class="op">=</span> <span class="fl">50</span><span class="op">:</span><span class="fl">100</span> <span class="co">#network to perturb</span>
<span class="va">network2</span><span class="op">=</span> <span class="fl">200</span><span class="op">:</span><span class="fl">250</span> <span class="co">#network to perturb</span>

<span class="va">bias_multiplier</span><span class="op">=</span> <span class="fl">0.6</span> <span class="co">#mean signal to inject (i.e. mean correlation with y)</span>
<span class="va">bias_variability</span><span class="op">=</span> <span class="fl">0.2</span> <span class="co">#variability - sd - around this mean signal</span>

<span class="co">#this function biases a given network as a function </span>
<span class="co">#of a behavioral score y</span>
<span class="va">m_bias</span><span class="op">=</span> <span class="fu"><a href="../reference/simulateFCnet.html">biasMat</a></span><span class="op">(</span>matrices <span class="op">=</span> <span class="va">m_start</span>, 
                y <span class="op">=</span> <span class="va">y</span>, 
                network1 <span class="op">=</span> <span class="va">network1</span>, 
                network2 <span class="op">=</span> <span class="va">network2</span>,
                bias_multiplier <span class="op">=</span> <span class="va">bias_multiplier</span>,
                bias_variability <span class="op">=</span> <span class="va">bias_variability</span>,
                mat_variability <span class="op">=</span> <span class="va">subjs_variability</span><span class="op">)</span></code></pre></div>
<p>We now have two sets of matrices: the starting set <code>m_start</code>, in which no signal has been added; the biased set <code>m_bias</code>, in which connections in a given subnetwork have been biased according to y. We will use the latter to test whether we can fit a predictive model and whether the most predictive edges fall within the subnetwork that we have perturbed.</p>
<p>The utility function <code>plotFC</code> gives a graphical depiction of a FC matrix. We can plot a representative participant:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#this adds a grid on the plot corresponding to the</span>
<span class="co">#network which was perturbed</span>
<span class="va">grid_net</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">network1</span><span class="op">)</span>, 
                         xmax<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">network1</span><span class="op">)</span>,
                         ymin<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">network2</span><span class="op">)</span>,
                         ymax<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">network2</span><span class="op">)</span><span class="op">)</span>,
                         size<span class="op">=</span> <span class="fl">1.05</span>, color<span class="op">=</span> <span class="st">"black"</span>, 
                         fill<span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>

<span class="va">ps</span><span class="op">=</span> <span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">m_start</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="co">#we plot one specific matrix</span>
           lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Start"</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span>

<span class="va">pb</span><span class="op">=</span> <span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">m_bias</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, 
           lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Bias"</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span>

<span class="co">#arrange plots</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">ps</span>, <span class="va">pb</span><span class="op">)</span></code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Indeed, we can plot the correlation map:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f_cor</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lst</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">n</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lst</span><span class="op">)</span>       
  <span class="va">rc</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">lst</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>        
  <span class="va">ar1</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">lst</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rc</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>     
  
  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">ar1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>            

<span class="op">}</span>

<span class="va">cor_bias</span><span class="op">=</span> <span class="fu">f_cor</span><span class="op">(</span><span class="va">m_bias</span>, <span class="va">y</span><span class="op">)</span> <span class="co">#warnings due to vectors being identical (e.g. diagonal)</span>

<span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">cor_bias</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Correlation map"</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span></code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We have indeed injected correlation between edges and the behavioral score in the highlighted region of the correlation matrix. The mean correlation is 0.6. We can also plot the variability between FC matrices, just to show that the only signal injected is correlation between edges and the behavioral score, not noise.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f_sd</span><span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lst</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">n</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lst</span><span class="op">)</span>       
  <span class="va">rc</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">lst</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>        
  <span class="va">ar1</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">lst</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rc</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>     
  
  <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">ar1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>            

<span class="op">}</span>

<span class="va">bias_sd</span><span class="op">=</span> <span class="fu">f_sd</span><span class="op">(</span><span class="va">m_bias</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">bias_sd</span>, limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Variability"</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span></code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="features-reduction" class="section level2">
<h2 class="hasAnchor">
<a href="#features-reduction" class="anchor"></a>Features reduction</h2>
<p>Once we have obtained all the simulated matrices, we can chain all the <code>FCnet</code> main functions in order to see whether models are predictive or not, and whether we can reconstruct the network that we have artificially biased.</p>
<p>We start with performing feature reduction through PCA. By default, <code><a href="../reference/reduce_featuresFC.html">reduce_featuresFC()</a></code> performs Principal Component Analysis (PCA) and returns, in the <code>Weights</code> slot, the components that explain at least 95% of the variance in the matrices. Other available techniques include Independent Component Analysis (ICA). Being this a very crude simulation, with our main bias probably tapping on the first few components, we will only ask the function to retain 10 features. Note that signal is usually more distributed in the matrices, thus this is rather artificial; a better simulation would perturb random edges, but that would be less visually clear within the scope of this overview.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_bias</span><span class="op">=</span> <span class="fu"><a href="../reference/reduce_featuresFC.html">reduce_featuresFC</a></span><span class="op">(</span>FCmatrices <span class="op">=</span> <span class="va">m_bias</span>, 
                           Ncomp <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </code></pre></div>
</div>
<div id="modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling" class="anchor"></a>Modelling</h2>
<p>We can run Leave-One-Out (nested cross-validated) robust regressions with one line:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r_bias</span><span class="op">=</span> <span class="fu"><a href="../reference/FCnetLOO.html">FCnetLOO</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, 
                 x <span class="op">=</span>  <span class="va">rf_bias</span>, 
                 alpha<span class="op">=</span> <span class="fl">0</span>, <span class="co">#ridge regression</span>
                 parallelLOO <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> 
<span class="va">r_bias</span><span class="op">$</span><span class="va">R2</span></code></pre></div>
<pre><code>## [1] 0.4358772</code></pre>
<p>It appears that this model is capable to explain about 43% of the variance from LOO observations.</p>
<p>A graphical depiction of the fit or coefficients can be obtained with <code><a href="../reference/plotFCnet.html">plotFCnet()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotFCnet.html">plotFCnet</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">r_bias</span>, 
          plot_labels <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co">#avoid padding, otherwise useful</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-10-1.png" width="864"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotFCnet.html">plotFCnet</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">r_bias</span>,
          output <span class="op">=</span> <span class="st">"coefficients"</span><span class="op">)</span> </code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-10-2.png" width="864"></p>
<p>As can be seen from the second plot, perhaps the model is still overparametrized, and the first coefficient seems to drive this effect. This is certainly due to the crude assumptions of this simulation.</p>
<p>A far more compelling proof, however, would be back-projection. Ideally, relevant edges will be scattered all around the matrix for non-predictive models, but will be more centered on the network (or interaction between networks) that we perturbed for really informative ones.</p>
</div>
<div id="visualization-and-back-projection" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-and-back-projection" class="anchor"></a>Visualization and back-projection</h2>
<p>We ensure that back-projected coefficients properly identify the network that we perturbed:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bp_bias</span><span class="op">=</span> <span class="fu"><a href="../reference/backprojectFCnet.html">backprojectFCnet</a></span><span class="op">(</span>coeffs <span class="op">=</span> <span class="va">r_bias</span>, 
                          reduce_features_object <span class="op">=</span> <span class="va">rf_bias</span>,
                          threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">network1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">network2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">bp_bias</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span></code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Indeed, predictive edges appear to highlight the exact same network we perturbed as the most relevant one, on top of a few spurious edges.</p>
<p>Back-projection by default computes the linear contribution to the behavioral score for all edges through the estimated coefficients. We checked before individual coefficients with <code>plotFCnet</code>: the most predictive component was the first one (note that this is a very crude simulation after all!). We can back-project only the edges tapping on this first component:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bp_first</span><span class="op">=</span> <span class="fu"><a href="../reference/backprojectFCnet.html">backprojectFCnet</a></span><span class="op">(</span>coeffs <span class="op">=</span> <span class="fl">1</span>,  
                          reduce_features_object <span class="op">=</span> <span class="va">rf_bias</span>,
                          threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">network1</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">network2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="../reference/plotFC.html">plotFC</a></span><span class="op">(</span><span class="va">bp_first</span><span class="op">)</span> <span class="op">+</span> <span class="va">grid_net</span></code></pre></div>
<p><img src="FCnet_overview_of_package_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Indeed, the first component mainly taps onto the network that we have biased. Edges have a negative loading on this feature, but they have a positive association with the behavioral score.</p>
</div>
<div id="testing-significance-permutation-test" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-significance-permutation-test" class="anchor"></a>Testing significance: permutation test</h2>
<p>Large R2 values may occur by chance or simply in light of the many predictors in the model - even though this problem is mitigated by using the LOO R2. In order to test whether this R2 is beyond chance, we can run a permutation test. Here, values of y are shuffled and then predicted. Ideally, the distribution of the models created in this way should cover - and inform about - the range of the null model.</p>
<p>Note that, in order to optimize computational resources, we only ask for 100 permutations (the default, but generally not enough) and, most importantly, we use parallel computing to optimize the procedure. When <code>parallelLOO</code> is <code>TRUE</code>, the outer cycles are run in parallel on multiple cores (if available) by using the package <code>future.apply</code>, which must be installed. In addition, <code>plan(multisession</code> or similar must be invoked in advance by the user.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span> <span class="co">#prepare for parallel computing</span>
<span class="va">perm_bias</span><span class="op">=</span> <span class="fu"><a href="../reference/permutateLOO.html">permutateLOO</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,
                        x<span class="op">=</span> <span class="va">rf_bias</span>, 
                        alpha <span class="op">=</span> <span class="fl">0</span>, 
                        parallelLOO <span class="op">=</span> <span class="cn">T</span>, 
                        nperm <span class="op">=</span> <span class="fl">100</span>, 
                        model_R2 <span class="op">=</span> <span class="va">r_bias</span>,
                        return_coeffs<span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">perm_bias</span><span class="op">$</span><span class="va">Summary</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="12%">
<col width="7%">
<col width="7%">
<col width="9%">
<col width="9%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="right">Model_R2</th>
<th align="right">Permutations</th>
<th align="right">P_value</th>
<th align="right">MeanR2</th>
<th align="right">SD_R2</th>
<th align="right">Upper_95</th>
<th align="right">Quantile_50</th>
<th align="right">Quantile_70</th>
<th align="right">Quantile_90</th>
<th align="right">Quantile_95</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.4358772</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">0.08124</td>
<td align="right">0.0741047</td>
<td align="right">0.2264851</td>
<td align="right">0.0658447</td>
<td align="right">0.1057252</td>
<td align="right">0.1694082</td>
<td align="right">0.2152632</td>
</tr></tbody>
</table>
<p>The original model’s R2 is reported on the left. On the rightmost part of the row, a few statistics concerning the distribution of R2 from null models is reported. The full distribution is available to the user anyway in the created object through the relative slot. In this fictional scenario, and considering the low number of permutations, it appears that the original model beats most null models. Models can always be improved by crossvalidating the number of features to extract, which is now implemented in both <code><a href="../reference/FCnetLOO.html">FCnetLOO()</a></code> and consequently <code><a href="../reference/permutateLOO.html">permutateLOO()</a></code>. In addition, selection of coefficients on the basis of permutated samples is now possible through the <code><a href="../reference/select_coefficients.html">select_coefficients()</a></code> function.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>These simulations were based on crude assumptions and parameters. Yet, they were only meant to confirm that, in principle, the procedures in <code>FCnet</code> may help recovering the most predictive connections from very rich and multidimensional datasets. More simulations are needed to check its sensitivity and specificity.</p>
</div>
<div id="appendix" class="section level2">
<h2 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h2>
<p>Packages’ versions:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.0.4 (2021-02-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] future.apply_1.7.0 future_1.21.0      gridExtra_2.3      ggplot2_3.3.3      FCnet_0.1.2.9000   glmnetUtils_1.1.8  glmnet_4.1-1       Matrix_1.3-2      
## 
## loaded via a namespace (and not attached):
##  [1] shape_1.4.5       settings_0.2.4    xfun_0.22         reshape2_1.4.4    listenv_0.8.0     splines_4.0.4     lattice_0.20-41   colorspace_2.0-0  vctrs_0.3.6       htmltools_0.5.1.1 mgcv_1.8-33       yaml_2.2.1        utf8_1.2.1        survival_3.2-7    rlang_0.4.10      pkgdown_1.6.1     pillar_1.5.1      glue_1.4.2        withr_2.4.1       plyr_1.8.6        foreach_1.5.1     lifecycle_1.0.0   stringr_1.4.0     munsell_0.5.0     gtable_0.3.0      ragg_1.1.2        codetools_0.2-18  memoise_2.0.0     evaluate_0.14     labeling_0.4.2    knitr_1.31        fastmap_1.1.0     parallel_4.0.4    fansi_0.4.2       highr_0.8         Rcpp_1.0.6        scales_1.1.1      cachem_1.0.4      desc_1.3.0        farver_2.1.0      parallelly_1.24.0 systemfonts_1.0.1 fs_1.5.0          textshaping_0.3.3 digest_0.6.27     stringi_1.5.3     grid_4.0.4        rprojroot_2.0.2   tools_4.0.4       magrittr_2.0.1    tibble_3.1.0      crayon_1.4.1      pkgconfig_2.0.3   ellipsis_0.3.1    rmarkdown_2.7    
## [56] iterators_1.0.13  R6_2.5.0          globals_0.14.0    nlme_3.1-152      compiler_4.0.4</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Elvio Blini, Michele De Filippo De Grazia, Alberto Testolin, Marco Zorzi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
